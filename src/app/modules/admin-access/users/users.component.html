<div class="animated-table-container bg-white p-3">
  <div class="container-fluid">
    <div class="row main_table_container">
      <div class="col-10">
        <div
          class="col-12 d-flex justify-content-between align-items-center d-none"
        >
          <h4>All Users List</h4>
          <div class="col-4 py-3 px-2 gap-2 d-flex">
            <div class="col-3">
              <select class="form-select" aria-label="Default select example">
                <option value="All" selected>All</option>
                <option value="ADMIN">Admin</option>
                <option value="USER">User</option>
              </select>
            </div>
            <input
              type="text"
              class="search_input form-control"
              placeholder="Search by name, username, email & phoneNumber"
            />
          </div>
        </div>

        <div class="header">
          <div class="left">
            <h5 class="text-start">All Users List</h5>
          </div>

          <div class="right">
            <div class="search_filter">
              <app-search-filter
                [borderRequired]="true"
                [placeholder]="'Search here..'"
                [formControl]="searchVal"
              >
              </app-search-filter>
            </div>
            <form [formGroup]="userForm">
              <app-single-select
                formControlName="roleName"
                [placeholder]="'Select Role'"
                [optionList]="['ALL', 'User', 'Admin']"
              >
              </app-single-select>
            </form>
          </div>
        </div>
        <!-- Users Table -->
        <table class="table table-striped">
          <thead class="thead-dark">
            <tr>
              <th>Id</th>
              <th>UserName</th>
              <th>Name</th>
              <th>Email</th>
              <th>Phone</th>
              <th>RoleName</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @if (userData.length > 0) { @for (user of userData; track $index) {
            <tr>
              <td>{{ user.userId }}</td>
              <td>{{ user.username }}</td>
              <td>{{ user.name }}</td>
              <td>{{ user.email }}</td>
              <td>{{ user.phoneNumber }}</td>
              <td>
                <div
                  class="rolename badge"
                  [ngClass]="{
                    admin: user.roleName === 'ADMIN',
                    user: user.roleName === 'USER'
                  }"
                >
                  {{ user.roleName }}
                </div>
              </td>
              <td>
                <button
                  class="btn btn-secondary"
                  (click)="toggleDropdown(user.userId)"
                >
                  <i-feather name="more-vertical"></i-feather>
                </button>
                @if (openedDropdownId === user.userId) {
                <div
                  class="position-relative"
                  appClickOutside
                  (clickedOutside)="openedDropdownId = null"
                >
                  <div class="dropdown">
                    <label class="label_field">
                      <input
                        class="form-check-input"
                        type="checkbox"
                        [checked]="user.roleName === 'ADMIN'"
                      />
                      <span class="label">Make Admin</span>
                    </label>
                    <div
                      class="label_field"
                      (click)="onDeleteUser(user.userId)"
                    >
                      <i-feather name="trash-2"></i-feather>

                      <span class="label">Delete User</span>
                    </div>
                  </div>
                </div>

                }
              </td>
            </tr>
            } } @else {
            <tr class="no_data_found_row">
              <td colspan="7">
                <div class="no_data_found">No User Found</div>
              </td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Modal Template -->
<ng-template #updateUser>
  <div class="modal-header">
    <h4 class="modal-title">Edit User</h4>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="onCancel()"
    ></button>
  </div>

  <form [formGroup]="userForm" (ngSubmit)="onUpdtateUser()">
    <div class="modal-body">
      <div class="mb-3">
        <label>User Name</label>
        <input
          readonly
          type="text"
          class="form-control"
          formControlName="username"
        />
      </div>

      <div class="mb-3">
        <label>Name</label>
        <input
          readonly
          type="text"
          class="form-control"
          formControlName="name"
        />
      </div>

      <div class="mb-3">
        <label>Email</label>
        <input
          readonly
          type="email"
          class="form-control"
          formControlName="email"
        />
      </div>

      <div class="mb-3">
        <label>Phone</label>
        <input
          readonly
          type="text"
          class="form-control"
          formControlName="phoneNumber"
        />
      </div>

      <div class="mb-3">
        <label>Role</label>
        <input type="text" class="form-control" formControlName="roleName" />
      </div>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="onCancel()">
        Cancel
      </button>
      <button
        type="submit"
        class="btn btn-primary"
        [disabled]="userForm.invalid"
      >
        Update User
      </button>
    </div>
  </form>
</ng-template>
